<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Countdown Service</title>
    <!-- OG Metadata for social media sharing -->
    <meta property="og:title" content="Countdown Service">
    <meta property="og:description" content="A customizable countdown timer with full-screen mode, sound effects, and confetti.">
    <meta property="og:image" content="https://placehold.co/1200x630/00bcd4/ffffff?text=Countdown+Service">
    <meta property="og:url" content="https://countdown.pages.dev">
    <meta property="og:type" content="website">

    <!-- Twitter Card Metadata -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Countdown Service">
    <meta name="twitter:description" content="A customizable countdown timer with full-screen mode, sound effects, and confetti.">
    <meta name="twitter:image" content="https://placehold.co/1200x630/00bcd4/ffffff?text=Countdown+Service">

    <!-- Tailwind CSS CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Font Awesome for fullscreen icon -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <!-- Google Fonts for Seven-Segment style numbers -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* Main styling for the entire screen */
        body {
            font-family: 'Orbitron', sans-serif;
            background-size: cover;
            background-position: center;
            transition: background-image 0.5s ease-in-out;
            background-color: #1a202c; /* Default dark background */
        }

        /* Add an overlay to make text more readable on the background */
        #background-overlay {
            background-color: rgba(0, 0, 0, 0.6);
        }

        /* Dynamic styling for countdown numbers based on screen size */
        .countdown-number {
            font-size: clamp(4rem, 15vw, 15rem); /* Adjusts size to be as large as possible */
            text-shadow: 0 0 20px #00FFFF, 0 0 30px #00FFFF, 0 0 40px #00FFFF; /* Glow effect */
            line-height: 1; /* Adjust line-height for better fit */
        }
        .countdown-label {
            font-size: clamp(1rem, 3vw, 2rem); /* Dynamic label size */
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }

        /* Animation for the blinking effect near the end */
        @keyframes blink-effect {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        .blinking-container {
            animation: blink-effect 0.5s infinite;
        }
        
        /* CSS for the confetti effect */
        .confetti-container {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            overflow: hidden;
            z-index: 20;
        }
        .confetti {
            position: absolute;
            width: 10px;
            height: 10px;
            background-color: #f0f;
            animation: confetti-fall 3s forwards;
            opacity: 0;
        }
        @keyframes confetti-fall {
            0% { transform: translateY(-100vh) rotate(0deg); opacity: 1; }
            100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
        }

    </style>
</head>
<body class="bg-gradient-to-br from-indigo-900 to-purple-900 text-white min-h-screen flex items-center justify-center p-4">

    <!-- Full-screen overlay -->
    <div id="background-overlay" class="absolute inset-0 z-0 flex items-center justify-center">

        <!-- Countdown and real-time clock display -->
        <div id="countdown-panel" class="text-center z-10 w-full">
            <div id="timer-display" class="flex flex-wrap justify-center items-center gap-4 md:gap-8">
                <!-- Hours -->
                <div class="flex flex-col items-center p-4">
                    <span id="hours" class="countdown-number font-bold">00</span>
                    <span class="countdown-label">Hours</span>
                </div>
                
                <!-- Minutes -->
                <div class="flex flex-col items-center p-4">
                    <span id="minutes" class="countdown-number font-bold">00</span>
                    <span class="countdown-label">Minutes</span>
                </div>
                
                <!-- Seconds -->
                <div class="flex flex-col items-center p-4">
                    <span id="seconds" class="countdown-number font-bold">00</span>
                    <span class="countdown-label">Seconds</span>
                </div>
            </div>
            
            <!-- End of countdown message and button -->
            <div id="finished-message-panel" class="hidden flex flex-col items-center mt-8">
                <div id="final-message" class="text-3xl md:text-5xl font-bold mb-4">
                    END!!
                </div>
                <button id="restart-button" class="mt-4 bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition-colors">
                    Restart
                </button>
            </div>

            <!-- Configuration section (shown when not counting down) -->
            <div id="config-panel" class="mt-8">
                <div class="bg-white/10 p-4 md:p-6 rounded-xl shadow-xl backdrop-blur-sm w-full max-w-lg mx-auto">
                    <!-- Input fields for hours, minutes, and seconds -->
                    <div class="flex items-center justify-center gap-2 mb-4">
                        <input type="number" id="countdown-hours" min="0" max="23" value="0" class="w-20 p-2 rounded-lg text-center text-black bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <span class="text-sm font-bold">Hours</span>
                        <input type="number" id="countdown-minutes" min="0" max="59" value="0" class="w-20 p-2 rounded-lg text-center text-black bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <span class="text-sm font-bold">Minutes</span>
                        <input type="number" id="countdown-seconds" min="0" max="59" value="0" class="w-20 p-2 rounded-lg text-center text-black bg-gray-200 focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <span class="text-sm font-bold">Seconds</span>
                    </div>
                    
                    <!-- Background image selection -->
                    <div class="mb-4">
                        <label for="background-image" class="block text-sm mb-2">Choose Background Image</label>
                        <input type="file" id="background-image" accept="image/*" class="w-full text-sm text-white file:mr-4 file:py-2 file:px-4 file:rounded-full file:border-0 file:text-sm file:font-semibold file:bg-blue-50 file:text-blue-700 hover:file:bg-blue-100">
                    </div>

                    <!-- Input for the end-of-countdown message -->
                    <div class="mb-4">
                        <label for="final-text-input" class="block text-sm mb-2">Message to display at the end (default is "END!!")</label>
                        <input type="text" id="final-text-input" placeholder="END!!" value="END!!" class="w-full p-2 rounded-lg text-black bg-gray-200 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    </div>
                    
                    <button id="start-button" class="w-full bg-blue-600 hover:bg-blue-700 text-white font-bold py-3 rounded-lg shadow-lg transition-colors">
                        Start Countdown
                    </button>
                </div>
            </div>
            
            <!-- Stop button -->
            <button id="reset-button" class="mt-4 bg-red-600 hover:bg-red-700 text-white font-bold py-2 px-6 rounded-lg shadow-lg transition-colors hidden">
                Stop Countdown
            </button>
        </div>
        
        <!-- Fullscreen Toggle Button -->
        <button id="fullscreen-button" class="fixed bottom-4 right-4 bg-gray-800 text-white p-3 rounded-full shadow-lg hover:bg-gray-700 transition-colors hidden">
            <i class="fa-solid fa-expand"></i>
        </button>
    </div>

    <!-- Audio element for the beep sound -->
    <audio id="beep-sound" preload="auto">
        <!-- Using a base64 encoded audio file for a simple beep -->
        <source src="data:audio/wav;base64,UklGRl9QDQBXQVZFZm10IBAAAAABAAEARKwAAIhYAQACABAAZGF0YSAXAAAAAQAAAQIAAQADAAIAAgACAAEAAAABAAIAAgACAAEAAAABAAEAAQAA" type="audio/wav">
    </audio>

    <script>
        // DOM Elements
        const body = document.body;
        const configPanel = document.getElementById('config-panel');
        const countdownPanel = document.getElementById('countdown-panel');
        const finishedMessagePanel = document.getElementById('finished-message-panel');
        const timerDisplay = document.getElementById('timer-display');
        const countdownHoursInput = document.getElementById('countdown-hours');
        const countdownMinutesInput = document.getElementById('countdown-minutes');
        const countdownSecondsInput = document.getElementById('countdown-seconds');
        const startButton = document.getElementById('start-button');
        const resetButton = document.getElementById('reset-button');
        const restartButton = document.getElementById('restart-button');
        const backgroundImageInput = document.getElementById('background-image');
        const finalTextInput = document.getElementById('final-text-input');
        const finalMessageElement = document.getElementById('final-message');
        const fullscreenButton = document.getElementById('fullscreen-button');

        const hoursElement = document.getElementById('hours');
        const minutesElement = document.getElementById('minutes');
        const secondsElement = document.getElementById('seconds');
        const beepSound = document.getElementById('beep-sound');

        let realTimeClockInterval;
        let countdownInterval;
        let hasInteracted = false; // Flag to check for user interaction

        // Function to pad a number with a leading zero
        function pad(number) {
            return number < 10 ? '0' + number : number;
        }

        // Function to save values to Local Storage
        function saveToLocalStorage(targetTimestamp, backgroundData, finalText) {
            localStorage.setItem('countdownTarget', targetTimestamp);
            if (backgroundData) {
                localStorage.setItem('backgroundImage', backgroundData);
            } else {
                localStorage.removeItem('backgroundImage');
            }
            if (finalText) {
                localStorage.setItem('finalText', finalText);
            } else {
                localStorage.removeItem('finalText');
            }
        }

        // Function to load values from Local Storage
        function loadFromLocalStorage() {
            const targetTimestamp = localStorage.getItem('countdownTarget');
            const backgroundData = localStorage.getItem('backgroundImage');
            const finalText = localStorage.getItem('finalText');
            return { targetTimestamp, backgroundData, finalText };
        }
        
        // Function to show the config panel and hide other elements
        function showConfigState() {
            configPanel.classList.remove('hidden');
            resetButton.classList.add('hidden');
            finishedMessagePanel.classList.add('hidden');
            fullscreenButton.classList.add('hidden');
            countdownPanel.classList.remove('blinking-container');
        }

        // Function to hide the config panel and show the countdown
        function showCountdownState() {
            configPanel.classList.add('hidden');
            resetButton.classList.remove('hidden');
            fullscreenButton.classList.remove('hidden');
        }
        
        // Function to create confetti effect
        function createConfetti() {
            const confettiContainer = document.createElement('div');
            confettiContainer.className = 'confetti-container';
            document.body.appendChild(confettiContainer);
            const colors = ['#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5', '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50', '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800', '#ff5722', '#795548', '#607d8b'];

            for (let i = 0; i < 150; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.width = Math.random() * 10 + 5 + 'px';
                confetti.style.height = confetti.style.width;
                confetti.style.left = Math.random() * 100 + 'vw';
                confetti.style.animationDelay = Math.random() * 2 + 's';
                confetti.style.animationDuration = Math.random() * 2 + 3 + 's';
                confettiContainer.appendChild(confetti);
            }

            // Remove confetti after 5 seconds
            setTimeout(() => {
                confettiContainer.remove();
            }, 5000);
        }

        // Function to start the real-time clock
        function startRealTimeClock() {
            // Clear any previous countdown interval
            clearInterval(countdownInterval);
            
            // Show config panel and hide the reset button
            showConfigState();

            // Start updating the clock every second
            realTimeClockInterval = setInterval(() => {
                const now = new Date();
                const hours = now.getHours();
                const minutes = now.getMinutes();
                const seconds = now.getSeconds();

                hoursElement.textContent = pad(hours);
                minutesElement.textContent = pad(minutes);
                secondsElement.textContent = pad(seconds);
            }, 1000);
        }

        // Function to update the display from user input
        function updateDisplayFromInput() {
            clearInterval(realTimeClockInterval); // Stop the real-time clock
            const hours = parseInt(countdownHoursInput.value) || 0;
            const minutes = parseInt(countdownMinutesInput.value) || 0;
            const seconds = parseInt(countdownSecondsInput.value) || 0;
            
            hoursElement.textContent = pad(hours);
            minutesElement.textContent = pad(minutes);
            secondsElement.textContent = pad(seconds);
        }
        
        // This function attempts to play the sound only after a user interaction
        function playBeepSound() {
            if (hasInteracted) {
                beepSound.play().catch(e => console.error("Audio playback failed:", e));
            }
        }

        // Function to start the countdown
        function startCountdown(targetTimestamp, backgroundData, finalText) {
            // Stop the real-time clock and show the countdown
            clearInterval(realTimeClockInterval);
            showCountdownState();
            
            if (backgroundData) {
                body.style.backgroundImage = `url(${backgroundData})`;
            }

            // Start updating every second
            countdownInterval = setInterval(() => {
                const now = new Date().getTime();
                const distance = targetTimestamp - now;

                // Check for the last 10 seconds
                if (distance > 0 && distance <= 10000) {
                    countdownPanel.classList.add('blinking-container');
                    if (beepSound.paused) {
                        playBeepSound();
                    }
                } else {
                    countdownPanel.classList.remove('blinking-container');
                    beepSound.pause();
                }

                // If countdown is finished
                if (distance < 0) {
                    clearInterval(countdownInterval);
                    countdownPanel.classList.remove('blinking-container');
                    beepSound.pause();
                    createConfetti(); // Create confetti effect
                    
                    // Show final message below the 00 00 00 display
                    timerDisplay.classList.remove('hidden');
                    hoursElement.textContent = '00';
                    minutesElement.textContent = '00';
                    secondsElement.textContent = '00';
                    finalMessageElement.textContent = finalText || 'END!!';
                    finishedMessagePanel.classList.remove('hidden');
                    resetButton.classList.add('hidden'); // Hide the Stop Countdown button
                    fullscreenButton.classList.add('hidden'); // Hide fullscreen button

                    localStorage.removeItem('countdownTarget');
                    localStorage.removeItem('backgroundImage');
                    localStorage.removeItem('finalText');
                    return;
                }

                // Calculate remaining time
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                // Update the display
                hoursElement.textContent = pad(hours);
                minutesElement.textContent = pad(minutes);
                secondsElement.textContent = pad(seconds);
            }, 1000);
        }
        
        // Function to toggle fullscreen mode
        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen().catch(err => {
                    alert(`Error attempting to enable full-screen mode: ${err.message} (${err.name})`);
                });
            } else {
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            }
        }

        // Event listener for the "Start Countdown" button
        startButton.addEventListener('click', () => {
            hasInteracted = true;
            const hours = parseInt(countdownHoursInput.value) || 0;
            const minutes = parseInt(countdownMinutesInput.value) || 0;
            const seconds = parseInt(countdownSecondsInput.value) || 0;

            if (hours === 0 && minutes === 0 && seconds === 0) {
                alert('Please set at least 1 second for the countdown.');
                return;
            }

            const totalMilliseconds = (hours * 60 * 60 + minutes * 60 + seconds) * 1000;
            const targetTimestamp = new Date().getTime() + totalMilliseconds;
            
            // Read background image file
            const file = backgroundImageInput.files[0];
            let backgroundData = null;
            let finalText = finalTextInput.value || 'END!!';

            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    backgroundData = e.target.result;
                    saveToLocalStorage(targetTimestamp, backgroundData, finalText);
                    startCountdown(targetTimestamp, backgroundData, finalText);
                };
                reader.readAsDataURL(file);
            } else {
                backgroundData = localStorage.getItem('backgroundImage'); // Use previously selected background
                saveToLocalStorage(targetTimestamp, backgroundData, finalText);
                startCountdown(targetTimestamp, backgroundData, finalText);
            }
        });

        // Event listener to change background immediately upon selecting a file
        backgroundImageInput.addEventListener('change', () => {
            const file = backgroundImageInput.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (e) => {
                    body.style.backgroundImage = `url(${e.target.result})`;
                };
                reader.readAsDataURL(file);
            }
        });

        // Event listener for the "Stop Countdown" button
        resetButton.addEventListener('click', () => {
            clearInterval(countdownInterval);
            localStorage.removeItem('countdownTarget');
            localStorage.removeItem('backgroundImage');
            localStorage.removeItem('finalText');
            body.style.backgroundImage = '';
            timerDisplay.classList.remove('hidden');
            finishedMessagePanel.classList.add('hidden');
            startRealTimeClock();
        });

        // Event listener for the "Restart" button
        restartButton.addEventListener('click', () => {
            // Hide the finished message panel
            finishedMessagePanel.classList.add('hidden');
            // Show the timer display
            timerDisplay.classList.remove('hidden');
            // Start the real-time clock display
            startRealTimeClock();
        });

        // Event listener for the fullscreen button
        fullscreenButton.addEventListener('click', toggleFullscreen);

        // Event listeners to update the display when the user inputs numbers
        countdownHoursInput.addEventListener('input', updateDisplayFromInput);
        countdownMinutesInput.addEventListener('input', updateDisplayFromInput);
        countdownSecondsInput.addEventListener('input', updateDisplayFromInput);
        finalTextInput.addEventListener('input', () => {
            localStorage.setItem('finalText', finalTextInput.value);
        });
        
        // This event listener captures the first user interaction
        document.addEventListener('mousedown', () => {
            hasInteracted = true;
        }, { once: true });
        document.addEventListener('keydown', () => {
            hasInteracted = true;
        }, { once: true });


        // Check Local Storage on page load
        window.addEventListener('load', () => {
            const { targetTimestamp, backgroundData, finalText } = loadFromLocalStorage();
            if (backgroundData) {
                body.style.backgroundImage = `url(${backgroundData})`;
            }

            if (finalText) {
                finalTextInput.value = finalText;
            } else {
                finalTextInput.value = 'END!!';
            }

            if (targetTimestamp && targetTimestamp > new Date().getTime()) {
                // If there is a saved value and it's not expired, continue the countdown
                startCountdown(targetTimestamp, backgroundData, finalText);
            } else {
                // Otherwise, show the config panel and real-time clock
                startRealTimeClock();
            }
        });
    </script>
</body>
</html>

